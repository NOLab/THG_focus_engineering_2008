Code used to generate (corrected version) of figure 3
